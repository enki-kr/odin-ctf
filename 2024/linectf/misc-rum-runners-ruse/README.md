## rum-runners-ruse

주어진 server.go 코드를 분석해보면, dist/cert/cert_file/cert.pem파일을 certPool에 등록한다.

```python
	cert, err := loadCertificate("cert.pem")
	if err != nil {
		fmt.Println(err)
		os.Exit(1)
	}
	certPool := x509.NewCertPool()
	certPool.AddCert(cert)
```

이후 클라이언트에서 업로드한 hexdata를 아래와 같이 verifySignature함수로 검증한다.
[verify sign](./images/verify_signature.png)

verifySignature함수는 PKCS7 객체에 서명 시간이 포함되어 있으면 해당 시간의 체인을 확인한다.
[verify with cert](./images/go_verifyWithChain.png)

cert.pem이 certPool에 등록되어 있으므로 cert.pem을 생성하는 코드인 key_gen.go를 보면, 2024.1.1~2124.1.1 범위가 유효하다.
[cert generate](./images/key_gen.png)

하지만 주어진 sign.der을 만들때 사용한 함수는 아래와 같이 2001년 시간대로 생성했다.
[sign.der](./images/signing.png)

sign.der을 ASN1 parser로 확인해보면 아래와 같이 날짜 필드가 두개 존재하며 한개는 2001년대, 한개는 2024년대 임을 알수 있다.
[duplicated sign](./images/duplicated_sign.png)

따라서 sign.der의 서명시간을 2024년 날짜로 인식시키기 위해 ASN1포맷의 해당 필드를 찾아 2001년대 필드와 위치를 바꿔줬다.
old_sign = `3082081B06092A864886F70D010702A082080C308208080201013109300706052B0E03021A301D06092A864886F70D010701A010040E4D697363206368616C6C656E6765A082050630820502308202EAA003020102020101300D06092A864886F70D01010B050030283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D3020170D3234303130313030303030305A180F32313234303130313030303030305A30283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D30820222300D06092A864886F70D01010105000382020F003082020A0282020100CDB0E28F7D7918C38619CEC1CAB7E868A33DA6E071973093EF9858D2B306ECAADE4692042B6AB0C125485ADFA1E862FF010501CF23A0BD448706F6B5EA948F6EC00FA163FEBF7817D0E924B226A5397AFE343A038E1769065876AACC8F4200FEBA0D575434600A1FD8A11BC06A973B12B8084886A6EB84B368CE89680019606DD0F052CA0396DFE2DA452A0D340CD1BA4DBE2ADA4F479E518E5CE41526707779ADDE7E6A916041AC69ECFF04B65053DF3FB2D66D2639806997547C930E789678AA047B89096EC995FC9AEE0DB7D1779C2A613E45A26F73581E621F2643191E81A0B82276A25DACA5EBF21E462BDF3A1AFCD6A7BF7C8967D495AE2C635C7078DC7D92711F2F64A63CC3EF7A7044782579A961DDD19AA7817A6B8AAA2B789E98D345A785CE98A8461944E49BD79411AF03F8124C2026787FDAF5617E445D79DD7820B46D3ABDE4B64D112B71D53612AC2F1FDD3EF0CA166CA337DFCEBA48889EC252F4B6332C0F81C20E63367731890EDE64E4040B02B1BB54379032422DC50529C6492C268E3B295E6F57397EA7E65AB6F461091DBA2273B249B20B7F257755E18628E186FF28B2BEE682108E30638F6952F0FC890E71D5AA05FD400CB48D2C83839FB91AC9DDF4D3CA8AD9EC70A1818E8E915CE7133B465D32AC50B3BC6A079710198C123C62DEDB6D397905E0B5AFD44F1ECB0BCF41BEC1E663462C96D2676D0203010001A3353033300E0603551D0F0101FF04040302078030130603551D25040C300A06082B06010505070301300C0603551D130101FF04023000300D06092A864886F70D01010B05000382020100629061C3507A418AA3E0AB7782E2B285693EEA0A9549AC45440D7FB898EC9FBD6D7CD626BBE930D3981727D2E1AC3051A5B6773967D8D83F3F629095956972481ECD5B58BAE5969ADE04D5A8FDF4837633E027660F39EB5940BF545A8F1218E7364BEA311B12B0CB9BB869241943C6B32D75176AE81B51B263C8C81DFFE0EF656509161F47868CCBFC7F50459B1F1FAA758193177B63BE33B475AC56666F0DD982427989815AC4E6B6A6BBC085621E4F2863A3E7F3C61AEF263105A0D316EC2604BBFB9A316A4C960E23F27561A9908B12892EDD9203D14D29A1779EC09F57552770F7E0F9AF7C3A56CB9DFDD786AFC4A488E1E4A0E585C0C841968B5D3C2A1BE6D7BC83B89C09F591D2031C6154776B0C76AE24272B9F12630CB1D3B65EBFA8DB0E5C188D7FB9D1CE908DE1D1BF99A80156D7DD9CFEC0D74DC6B92FED95D591DE196349E6D0CD46DB8A27FBE500D4E649267BD41E8D77AFC6439090AFE47E86930E80DC203920550972F75D54418BFEF4D5E521FEE7AD6BB23DE3DE85251D957537F20622FCFA4B435D14A001B0F0701412723D1B62D4E447508881EFD594B6564D0A97E9B5ABFD53465E869AADF293A55AA08B7193D15AFCDD50B1462BA451348F8E47FDCCAC72B91F41F7EE8E1259FCB1E46EDCA31249A2A0F6E72E96A9DE8333672BBE9D8EEA083543EB75054E7641E53B254757B460FF411D8CB6639240318202CD308202C9020101302D30283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D020101300706052B0E03021AA07B301806092A864886F70D010903310B06092A864886F70D010701301C06092A864886F70D010905310F170D3030303130313031303130315A301C06092A864886F70D010905310F170D3234303231353030303531395A302306092A864886F70D010904311604142DF3098E04233DBF257B2F0ADF62CE6117DE4BB4300B06092A864886F70D010105048202003BFF2E0369595F0C11CED7DB3EA1595334D2D5A2135CD4F4A809FA2250359E6BDBCD99548A22121AB0058334BDF20B2602A98C9EEBA95BA57D739E3F802FE3B85E093C2A40966D7442817E28B9F23580348A124B68A66C2322EE3AB5892807E34E1E239AA5EB86C9B2E84DD9BC20C2725B9793252DADF1C4960365B183BE3243ACAABFD66603BAA495B90F6C6EC752758DA49134422B86329D1ABC55DC1D693F18391BDB0EB63779EC00D9F01315802CE72BA6E670765A740D933F15253C710D8FA96795C6741BE1ADCF04302F899D8D60036D36D386E14F94C796604CD2883257B874464A7727ACAA637005326E6439B8A1E6314ECB3E562246D9A475FFD9088E299728BB456D8EA16469A5CAA33A383EDD9167083594BB9C0E630DCC99098E9A78C144306D65764B1257EC8EDCBBF0AF2A6658927E2F9005667744E6FD4D0C9D1CEF2C60458A10E67437035D2FF9631210511FA42C1197C845C7AE536215F74D5D0CD7DA46F685E6833FA0DEECA7BD26079B72AB5D2580BEDD03768F8A8A39FC656F953846AB213E4C2BA20ED1579120A14947DC3047F1FF3F9D492C1490180DF3422DE6A6D1D9BC8E6AB3D71A799A6DFDBD870FFAAF64752ABBA342CF8B9F44A56AFCCF96A26588A2705395B411236B4B54FB86C1607EC0A19A4AF625A82B0EA57A59EB1C7BB35E0DBF8A50034E012C0FEF03156E8C38A319F992E96E750B`

ASN1 decoder을 사용해서 찾은 값은 아래 그림과 같다.
[der parse](./images/DER_parse.png)

2001_old_time = `301C06092A864886F70D010905310F170D3030303130313031303130315A`
2024_new_time = `301C06092A864886F70D010905310F170D3234303231353030303531395A`

위 필드의 서순을 바꾼 new_sign을 new_sign.der로 저장한다.

```python
new_sign = '3082081B06092A864886F70D010702A082080C308208080201013109300706052B0E03021A301D06092A864886F70D010701A010040E4D697363206368616C6C656E6765A082050630820502308202EAA003020102020101300D06092A864886F70D01010B050030283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D3020170D3234303130313030303030305A180F32313234303130313030303030305A30283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D30820222300D06092A864886F70D01010105000382020F003082020A0282020100CDB0E28F7D7918C38619CEC1CAB7E868A33DA6E071973093EF9858D2B306ECAADE4692042B6AB0C125485ADFA1E862FF010501CF23A0BD448706F6B5EA948F6EC00FA163FEBF7817D0E924B226A5397AFE343A038E1769065876AACC8F4200FEBA0D575434600A1FD8A11BC06A973B12B8084886A6EB84B368CE89680019606DD0F052CA0396DFE2DA452A0D340CD1BA4DBE2ADA4F479E518E5CE41526707779ADDE7E6A916041AC69ECFF04B65053DF3FB2D66D2639806997547C930E789678AA047B89096EC995FC9AEE0DB7D1779C2A613E45A26F73581E621F2643191E81A0B82276A25DACA5EBF21E462BDF3A1AFCD6A7BF7C8967D495AE2C635C7078DC7D92711F2F64A63CC3EF7A7044782579A961DDD19AA7817A6B8AAA2B789E98D345A785CE98A8461944E49BD79411AF03F8124C2026787FDAF5617E445D79DD7820B46D3ABDE4B64D112B71D53612AC2F1FDD3EF0CA166CA337DFCEBA48889EC252F4B6332C0F81C20E63367731890EDE64E4040B02B1BB54379032422DC50529C6492C268E3B295E6F57397EA7E65AB6F461091DBA2273B249B20B7F257755E18628E186FF28B2BEE682108E30638F6952F0FC890E71D5AA05FD400CB48D2C83839FB91AC9DDF4D3CA8AD9EC70A1818E8E915CE7133B465D32AC50B3BC6A079710198C123C62DEDB6D397905E0B5AFD44F1ECB0BCF41BEC1E663462C96D2676D0203010001A3353033300E0603551D0F0101FF04040302078030130603551D25040C300A06082B06010505070301300C0603551D130101FF04023000300D06092A864886F70D01010B05000382020100629061C3507A418AA3E0AB7782E2B285693EEA0A9549AC45440D7FB898EC9FBD6D7CD626BBE930D3981727D2E1AC3051A5B6773967D8D83F3F629095956972481ECD5B58BAE5969ADE04D5A8FDF4837633E027660F39EB5940BF545A8F1218E7364BEA311B12B0CB9BB869241943C6B32D75176AE81B51B263C8C81DFFE0EF656509161F47868CCBFC7F50459B1F1FAA758193177B63BE33B475AC56666F0DD982427989815AC4E6B6A6BBC085621E4F2863A3E7F3C61AEF263105A0D316EC2604BBFB9A316A4C960E23F27561A9908B12892EDD9203D14D29A1779EC09F57552770F7E0F9AF7C3A56CB9DFDD786AFC4A488E1E4A0E585C0C841968B5D3C2A1BE6D7BC83B89C09F591D2031C6154776B0C76AE24272B9F12630CB1D3B65EBFA8DB0E5C188D7FB9D1CE908DE1D1BF99A80156D7DD9CFEC0D74DC6B92FED95D591DE196349E6D0CD46DB8A27FBE500D4E649267BD41E8D77AFC6439090AFE47E86930E80DC203920550972F75D54418BFEF4D5E521FEE7AD6BB23DE3DE85251D957537F20622FCFA4B435D14A001B0F0701412723D1B62D4E447508881EFD594B6564D0A97E9B5ABFD53465E869AADF293A55AA08B7193D15AFCDD50B1462BA451348F8E47FDCCAC72B91F41F7EE8E1259FCB1E46EDCA31249A2A0F6E72E96A9DE8333672BBE9D8EEA083543EB75054E7641E53B254757B460FF411D8CB6639240318202CD308202C9020101302D30283110300E060355040A13074578616D706C65311430120603550403130B6578616D706C652E636F6D020101300706052B0E03021AA07B301806092A864886F70D010903310B06092A864886F70D010701301C06092A864886F70D010905310F170D3234303231353030303531395A301C06092A864886F70D010905310F170D3030303130313031303130315A302306092A864886F70D010904311604142DF3098E04233DBF257B2F0ADF62CE6117DE4BB4300B06092A864886F70D010105048202003BFF2E0369595F0C11CED7DB3EA1595334D2D5A2135CD4F4A809FA2250359E6BDBCD99548A22121AB0058334BDF20B2602A98C9EEBA95BA57D739E3F802FE3B85E093C2A40966D7442817E28B9F23580348A124B68A66C2322EE3AB5892807E34E1E239AA5EB86C9B2E84DD9BC20C2725B9793252DADF1C4960365B183BE3243ACAABFD66603BAA495B90F6C6EC752758DA49134422B86329D1ABC55DC1D693F18391BDB0EB63779EC00D9F01315802CE72BA6E670765A740D933F15253C710D8FA96795C6741BE1ADCF04302F899D8D60036D36D386E14F94C796604CD2883257B874464A7727ACAA637005326E6439B8A1E6314ECB3E562246D9A475FFD9088E299728BB456D8EA16469A5CAA33A383EDD9167083594BB9C0E630DCC99098E9A78C144306D65764B1257EC8EDCBBF0AF2A6658927E2F9005667744E6FD4D0C9D1CEF2C60458A10E67437035D2FF9631210511FA42C1197C845C7AE536215F74D5D0CD7DA46F685E6833FA0DEECA7BD26079B72AB5D2580BEDD03768F8A8A39FC656F953846AB213E4C2BA20ED1579120A14947DC3047F1FF3F9D492C1490180DF3422DE6A6D1D9BC8E6AB3D71A799A6DFDBD870FFAAF64752ABBA342CF8B9F44A56AFCCF96A26588A2705395B411236B4B54FB86C1607EC0A19A4AF625A82B0EA57A59EB1C7BB35E0DBF8A50034E012C0FEF03156E8C38A319F992E96E750B'
with open("./new_sign.der", "wb") as f:
    f.write(bytes.fromhex(new_sign))
```

저장된 der파일을 upload.py를 이용해 서버에 업로드하면 플래그를 얻을 수 있다.
